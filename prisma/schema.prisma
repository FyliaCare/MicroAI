// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextSearchPostgres"]
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Client {
  id          String    @id @default(uuid())
  name        String
  email       String    @unique
  phone       String?
  company     String?
  website     String?
  address     String?
  city        String?
  country     String?   @default("Ghana")
  taxId       String?
  notes       String?
  status      String    @default("active") // active, inactive, archived
  
  // Communication preferences
  preferredContact String? // email, phone, teams
  timezone         String? @default("Africa/Accra")
  
  // Business info
  industry         String?
  companySize      String? // solo, small, medium, enterprise
  
  // Metadata
  source           String? // referral, website, social-media, other
  referredBy       String?
  tags             String? // JSON array
  customFields     String? // JSON for extensibility
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  projects    Project[]
  quotes      Quote[]
  invoices    Invoice[]
  contracts   Contract[]
  communications Communication[]
  documents   Document[]

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([name])
  @@index([company])
  @@index([country])
}

model Project {
  id            String    @id @default(uuid())
  name          String
  description   String?
  type          String    // web-app, saas, website, web-tool, custom, ecommerce
  status        String    @default("planning") // planning, in-progress, review, completed, on-hold, cancelled
  priority      String    @default("medium") // low, medium, high, urgent
  
  // Financial
  budget        Float?
  actualCost    Float?
  revenue       Float?
  profitMargin  Float?
  currency      String    @default("GHS")
  
  // Timeline
  startDate     DateTime?
  endDate       DateTime?
  deadline      DateTime?
  completedAt   DateTime?
  estimatedHours Float?
  actualHours    Float?
  
  // Technical
  techStack     String?   // JSON string of technologies
  githubRepo    String?
  liveUrl       String?
  stagingUrl    String?
  demoUrl       String?
  
  // Deployment
  hosting       String?   // vercel, render, aws, custom
  domain        String?
  sslCertificate Boolean  @default(false)
  
  // Management
  progress      Int       @default(0) // 0-100
  notes         String?
  requirements  String?   // JSON of detailed requirements
  attachments   String?   // JSON array of file URLs
  
  // Performance tracking
  health        String    @default("good") // good, warning, critical
  uptime        Float     @default(100)
  lastChecked   DateTime?
  
  // Custom fields
  customFields  String?   // JSON for extensibility
  tags          String?   // JSON array
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  clientId      String?
  client        Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
  teamMembers   ProjectTeam[]
  tasks         Task[]
  milestones    Milestone[]
  invoices      Invoice[]
  quote         Quote?
  timeEntries   TimeEntry[]
  documents     Document[]
  comments      Comment[]
  deployments   Deployment[]
  expenses      Expense[]

  @@index([clientId])
  @@index([status])
  @@index([type])
  @@index([priority])
  @@index([createdAt])
  @@index([deadline])
  @@index([name])
  @@index([health])
}

model Quote {
  id              String    @id @default(uuid())
  quoteNumber     String    @unique
  title           String
  description     String?
  
  // 1. Company/Provider Details (pulled from settings)
  companyName     String?
  companyEmail    String?
  companyPhone    String?
  companyAddress  String?
  companyWebsite  String?
  companyLogo     String?
  
  // 2. Client Information
  clientId        String?
  client          Client?   @relation(fields: [clientId], references: [id])
  clientName      String?
  clientCompany   String?
  clientEmail     String?
  clientPhone     String?
  clientAddress   String?
  contactPerson   String?
  
  // 3. Project Details
  projectId       String?   @unique
  project         Project?  @relation(fields: [projectId], references: [id])
  projectType     String?   // basic-website, business-website, web-app, ecommerce, saas
  
  // 4. Executive Summary
  executiveSummary String?  // JSON: { problem, solution, businessImpact }
  
  // 5. Scope of Work / Deliverables
  scopeOfWork     String?   // JSON array of deliverable objects
  exclusions      String?   // JSON array of what's NOT included
  
  // 6. Technical Stack
  techStack       String?   // JSON: { frameworks, libraries, hosting, thirdParty }
  
  // 7. Timeline & Milestones
  timeline        String?   // e.g., "6-8 weeks"
  estimatedHours  Float?
  milestones      String?   // JSON: [{ phase, duration, deliverables, payment }]
  
  // 8. Pricing Breakdown
  pricingItems    String?   // JSON: [{ category, description, amount, isRecurring, frequency }]
  subtotal        Float?
  tax             Float?    @default(0)
  taxRate         Float?    @default(0)
  discount        Float?    @default(0)
  discountType    String?   // percentage, fixed
  total           Float?
  currency        String?   @default("USD")
  
  // 9. Payment Terms
  paymentTerms    String?   // JSON: { depositPercent, milestonePayments, finalPayment, methods, latePenalty }
  depositAmount   Float?
  depositPercent  Float?
  
  // 10. Assumptions & Client Obligations
  assumptions     String?   // JSON array of assumptions
  clientObligations String? // JSON array of client responsibilities
  
  // 11. Maintenance & Support
  maintenanceTerms String?  // JSON: { freeSupportDuration, ongoingOptions }
  freeSupportMonths Int?    @default(1)
  monthlyMaintenance Float?  @default(0)
  
  // 12. Intellectual Property Rights
  ipRights        String?   // Text describing IP ownership
  
  // 13. Revisions Policy
  revisionsPolicy String?   // JSON: { includedRevisions, additionalCost }
  includedRevisions Int?    @default(2)
  revisionCost    Float?
  
  // 14. Confidentiality
  confidentialityClause String? // NDA/confidentiality text
  
  // 15. Signatures
  clientSignature     String?  // Base64 or URL
  clientSignedAt      DateTime?
  clientSignedBy      String?
  providerSignature   String?  // Base64 or URL
  providerSignedAt    DateTime?
  providerSignedBy    String?
  
  // Legacy fields (keeping for backward compatibility)
  setupFee        Float?     @default(0)
  developmentCost Float?     @default(0)
  designCost      Float?     @default(0)
  monthlyHosting  Float?     @default(0)
  items           String?   // JSON: development tasks, features, deliverables
  hostingBreakdown String?  // JSON: hosting costs breakdown
  deliverables    String?   // JSON: list of deliverables
  monthlyRecurring Float?    @default(0)
  yearlyRecurring  Float?    @default(0)
  
  // Status & Validity
  status          String    @default("draft") // draft, sent, viewed, accepted, rejected, expired
  validUntil      DateTime?
  validityDays    Int       @default(30)
  
  // Dates
  issuedAt        DateTime?
  sentAt          DateTime?
  viewedAt        DateTime?
  respondedAt     DateTime?
  
  notes           String?
  terms           String?   // General T&C
  internalNotes   String?   // Private notes not shown to client
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([clientId])
  @@index([projectId])
  @@index([status])
  @@index([quoteNumber])
  @@index([createdAt])
  @@index([validUntil])
}

model Invoice {
  id              String    @id @default(uuid())
  invoiceNumber   String    @unique
  title           String
  description     String?
  
  // Client & Project
  clientId        String?
  client          Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
  projectId       String?
  project         Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)
  
  // Amounts
  subtotal        Float
  tax             Float     @default(0)
  taxRate         Float     @default(0)
  discount        Float     @default(0)
  discountType    String    @default("amount") // amount, percentage
  total           Float
  paidAmount      Float     @default(0)
  currency        String    @default("GHS")
  
  // Items/Services
  items           String    // JSON string of line items
  
  // Status & Payment
  status          String    @default("draft") // draft, sent, viewed, partial, paid, overdue, cancelled, refunded
  paymentMethod   String?
  paymentDate     DateTime?
  
  // Dates
  issuedAt        DateTime?
  dueDate         DateTime?
  sentAt          DateTime?
  
  // Payment tracking
  payments        Payment[]
  
  // Reminders
  remindersSent   Int       @default(0)
  lastReminderAt  DateTime?
  
  notes           String?
  terms           String?
  
  // Recurring invoice
  isRecurring     Boolean   @default(false)
  recurringPeriod String?   // monthly, quarterly, yearly
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([clientId])
  @@index([projectId])
  @@index([status])
  @@index([invoiceNumber])
  @@index([dueDate])
  @@index([issuedAt])
}

model Task {
  id            String    @id @default(uuid())
  title         String
  description   String?
  status        String    @default("todo") // todo, in-progress, review, completed, blocked
  priority      String    @default("medium") // low, medium, high, urgent
  
  // Time tracking
  estimatedHours Float?
  actualHours    Float?
  
  // Dates
  startDate     DateTime?
  dueDate       DateTime?
  completedAt   DateTime?
  
  // Assignment
  assignedTo    String?   // User/team member name or ID
  
  // Relations
  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  timeEntries   TimeEntry[]
  comments      Comment[]
  
  // Checklist
  checklist     String?   // JSON array of subtasks
  
  tags          String?   // JSON array of tags
  attachments   String?   // JSON array of file URLs
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([projectId])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
}

model Milestone {
  id            String    @id @default(uuid())
  title         String
  description   String?
  status        String    @default("pending") // pending, in-progress, completed, missed
  
  // Deliverables
  deliverables  String?   // JSON array of deliverables
  
  // Dates
  dueDate       DateTime?
  completedAt   DateTime?
  
  // Payment
  paymentAmount Float?
  isPaid        Boolean   @default(false)
  
  // Relations
  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id])
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Admin {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String    // Hashed
  name          String
  role          String    @default("admin") // admin, super-admin, manager
  isActive      Boolean   @default(true)
  
  lastLoginAt   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // NextAuth relations
  accounts      Account[]
  sessions      Session[]
}

// NextAuth models for session management
model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user Admin @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         Admin    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Service {
  id            String    @id @default(uuid())
  name          String
  description   String?
  category      String    // web-development, design, consulting, maintenance, other
  
  // Pricing
  priceType     String    @default("fixed") // fixed, hourly, project-based, custom
  basePrice     Float?
  minPrice      Float?
  maxPrice      Float?
  hourlyRate    Float?
  
  // Details
  features      String?   // JSON array of features
  deliverables  String?   // JSON array of deliverables
  duration      String?   // Estimated duration (e.g., "2-4 weeks")
  
  // Status
  isActive      Boolean   @default(true)
  isPopular     Boolean   @default(false)
  
  // SEO & Display
  icon          String?   // Icon name or emoji
  color         String?   // Color code for display
  sortOrder     Int       @default(0)
  
  tags          String?   // JSON array of tags
  notes         String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model ActivityLog {
  id          String    @id @default(uuid())
  action      String    // Created, Updated, Deleted, etc.
  entity      String    // Project, Client, Quote, etc.
  entityId    String
  description String?
  userId      String?   // Admin who performed the action
  metadata    String?   // JSON string of additional data
  
  createdAt   DateTime  @default(now())
}

model Notification {
  id          String    @id @default(uuid())
  type        String    // new-project, new-contact, quote-request, project-update
  title       String
  message     String
  link        String?   // URL to navigate to when clicked
  isRead      Boolean   @default(false)
  priority    String    @default("normal") // low, normal, high, urgent
  
  // Related entities
  entityType  String?   // Project, Client, Quote
  entityId    String?
  
  createdAt   DateTime  @default(now())
  readAt      DateTime?

  @@index([isRead])
  @@index([type])
  @@index([createdAt])
  @@index([priority])
}

model QuoteTemplate {
  id              String    @id @default(uuid())
  name            String    // e.g., "Basic Website", "E-commerce Platform"
  category        String    // basic-website, business-website, web-app, ecommerce, saas
  description     String?
  
  // Pricing Structure
  setupFee        Float
  developmentCost Float
  designCost      Float     @default(0)
  monthlyHosting  Float
  monthlyMaintenance Float  @default(0)
  
  // Project Details
  estimatedHours  Float
  timeline        String    // e.g., "2-3 weeks"
  techStack       String    // JSON array: ["Next.js", "TypeScript", "PostgreSQL"]
  
  // Breakdown
  features        String    // JSON array of included features
  deliverables    String    // JSON array of deliverables
  hostingBreakdown String   // JSON: detailed hosting costs
  milestones      String?   // JSON: payment milestones
  
  // Costs Breakdown (for transparency)
  actualCosts     String?   // JSON: your actual costs per service
  profitMargin    Float     @default(100) // Percentage markup
  
  // Display
  isActive        Boolean   @default(true)
  sortOrder       Int       @default(0)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// ==================== NEW ADVANCED MODELS ====================

model TeamMember {
  id            String    @id @default(uuid())
  name          String
  email         String    @unique
  phone         String?
  role          String    // developer, designer, project-manager, qa, devops
  title         String?   // Senior Developer, Lead Designer, etc.
  
  // Skills & Expertise
  skills        String?   // JSON array of skills
  hourlyRate    Float?
  availability  String    @default("available") // available, busy, unavailable
  
  // Authentication (if they need login access)
  password      String?   // Hashed
  isActive      Boolean   @default(true)
  
  // Profile
  avatar        String?
  bio           String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  projectAssignments ProjectTeam[]
  timeEntries        TimeEntry[]
  comments           Comment[]
  
  @@index([email])
  @@index([role])
  @@index([isActive])
}

model ProjectTeam {
  id            String    @id @default(uuid())
  role          String    // lead, developer, designer, etc.
  
  // Relations
  projectId     String
  project       Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  memberId      String
  member        TeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  assignedAt    DateTime  @default(now())
  
  @@unique([projectId, memberId])
  @@index([projectId])
  @@index([memberId])
}

model TimeEntry {
  id            String    @id @default(uuid())
  description   String
  hours         Float
  date          DateTime  @default(now())
  billable      Boolean   @default(true)
  hourlyRate    Float?
  
  // Relations
  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)
  
  taskId        String?
  task          Task?     @relation(fields: [taskId], references: [id], onDelete: SetNull)
  
  memberId      String?
  member        TeamMember? @relation(fields: [memberId], references: [id], onDelete: SetNull)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([projectId])
  @@index([taskId])
  @@index([memberId])
  @@index([date])
}

model Document {
  id            String    @id @default(uuid())
  name          String
  description   String?
  type          String    // contract, proposal, design, requirement, other
  fileUrl       String
  fileSize      Int?      // in bytes
  mimeType      String?
  
  // Access control
  isPublic      Boolean   @default(false)
  
  // Relations
  clientId      String?
  client        Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
  
  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)
  
  uploadedBy    String?   // Admin ID
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([clientId])
  @@index([projectId])
  @@index([type])
  @@index([createdAt])
}

model Comment {
  id            String    @id @default(uuid())
  content       String
  isInternal    Boolean   @default(false) // Internal team notes vs client-visible
  
  // Relations
  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  taskId        String?
  task          Task?     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  
  authorId      String?
  author        TeamMember? @relation(fields: [authorId], references: [id], onDelete: SetNull)
  
  // Threading
  parentId      String?
  parent        Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies       Comment[] @relation("CommentReplies")
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([projectId])
  @@index([taskId])
  @@index([authorId])
  @@index([parentId])
  @@index([createdAt])
}

model Communication {
  id            String    @id @default(uuid())
  type          String    // email, call, meeting, chat
  subject       String?
  content       String
  direction     String    // inbound, outbound
  
  // Relations
  clientId      String?
  client        Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
  
  // Metadata
  from          String?
  to            String?
  cc            String?   // JSON array
  attachments   String?   // JSON array
  
  sentBy        String?   // Admin ID
  
  createdAt     DateTime  @default(now())
  
  @@index([clientId])
  @@index([type])
  @@index([createdAt])
}

model Contract {
  id            String    @id @default(uuid())
  title         String
  description   String?
  type          String    // service-agreement, nda, sow, amendment
  status        String    @default("draft") // draft, sent, signed, active, completed, terminated
  
  // Content
  content       String    // Full contract text or JSON template
  
  // Parties
  clientId      String?
  client        Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
  
  // Dates
  startDate     DateTime?
  endDate       DateTime?
  signedAt      DateTime?
  
  // Financial
  value         Float?
  currency      String    @default("GHS")
  
  // Files
  documentUrl   String?
  signedDocumentUrl String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([clientId])
  @@index([status])
  @@index([type])
  @@index([startDate])
}

model Deployment {
  id            String    @id @default(uuid())
  version       String    // v1.0.0, v1.1.0
  environment   String    // development, staging, production
  status        String    // pending, in-progress, success, failed, rolled-back
  
  // Deployment info
  commitHash    String?
  branch        String?
  deployedBy    String?   // Admin/Team member ID
  
  // URLs
  url           String?
  
  // Metadata
  notes         String?
  changelog     String?   // JSON array of changes
  
  // Performance
  buildTime     Int?      // in seconds
  
  // Relations
  projectId     String
  project       Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  deployedAt    DateTime  @default(now())
  
  @@index([projectId])
  @@index([environment])
  @@index([status])
  @@index([deployedAt])
}

model Expense {
  id            String    @id @default(uuid())
  description   String
  category      String    // hosting, tools, subscriptions, marketing, other
  amount        Float
  currency      String    @default("GHS")
  
  // Payment info
  paymentMethod String?   // bank-transfer, card, mobile-money
  receipt       String?   // URL to receipt/invoice
  
  // Relations
  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)
  
  // Dates
  date          DateTime  @default(now())
  paidAt        DateTime?
  
  // Status
  status        String    @default("pending") // pending, paid, reimbursed
  
  // Metadata
  vendor        String?
  notes         String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([projectId])
  @@index([category])
  @@index([date])
  @@index([status])
}

model Payment {
  id            String    @id @default(uuid())
  amount        Float
  currency      String    @default("GHS")
  method        String    // bank-transfer, card, mobile-money, paypal
  
  // Reference
  reference     String?   // Transaction reference
  receipt       String?   // Receipt URL
  
  // Relations
  invoiceId     String?
  invoice       Invoice?  @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  
  // Status
  status        String    @default("pending") // pending, completed, failed, refunded
  
  // Dates
  paidAt        DateTime?
  
  notes         String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([invoiceId])
  @@index([status])
  @@index([paidAt])
  @@index([reference])
}

model Setting {
  id            String    @id @default(uuid())
  key           String    @unique
  value         String    // JSON string for complex values
  type          String    // string, number, boolean, json
  category      String    // company, email, payment, general
  description   String?
  
  updatedAt     DateTime  @updatedAt
  
  @@index([category])
}

model AuditLog {
  id            String    @id @default(uuid())
  action        String    // CREATE, UPDATE, DELETE, LOGIN, LOGOUT
  entity        String    // Project, Client, Quote, Admin, etc.
  entityId      String?
  
  // Changes
  oldValue      String?   // JSON snapshot before change
  newValue      String?   // JSON snapshot after change
  
  // User
  userId        String?
  userEmail     String?
  userIp        String?
  userAgent     String?
  
  // Metadata
  description   String?
  metadata      String?   // Additional JSON data
  
  createdAt     DateTime  @default(now())
  
  @@index([entity])
  @@index([entityId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

model EmailTemplate {
  id            String    @id @default(uuid())
  name          String
  subject       String
  content       String    // HTML content with placeholders
  type          String    // quote-sent, invoice-sent, project-update, welcome
  
  // Variables used in template
  variables     String?   // JSON array of variable names
  
  isActive      Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([type])
  @@index([isActive])
}

model EmailLog {
  id            String    @id @default(uuid())
  to            String
  from          String
  subject       String
  content       String?
  
  // Status
  status        String    @default("pending") // pending, sent, failed, bounced
  provider      String?   // resend, smtp, etc.
  providerId    String?   // Provider's message ID
  
  // Error handling
  error         String?
  retryCount    Int       @default(0)
  
  // Relations
  templateId    String?
  clientId      String?
  
  sentAt        DateTime?
  createdAt     DateTime  @default(now())
  
  @@index([to])
  @@index([status])
  @@index([createdAt])
  @@index([templateId])
}

model ApiKey {
  id            String    @id @default(uuid())
  name          String
  key           String    @unique
  description   String?
  
  // Permissions
  permissions   String    // JSON array of allowed endpoints
  
  // Rate limiting
  rateLimit     Int       @default(1000) // Requests per hour
  
  // Status
  isActive      Boolean   @default(true)
  expiresAt     DateTime?
  
  // Usage tracking
  lastUsedAt    DateTime?
  usageCount    Int       @default(0)
  
  createdBy     String?   // Admin ID
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([key])
  @@index([isActive])
}

model WebhookEndpoint {
  id            String    @id @default(uuid())
  url           String
  events        String    // JSON array of events to listen to
  secret        String?   // For signature verification
  
  isActive      Boolean   @default(true)
  
  // Retry configuration
  maxRetries    Int       @default(3)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  deliveries    WebhookDelivery[]
  
  @@index([isActive])
}

model WebhookDelivery {
  id            String    @id @default(uuid())
  event         String    // project.created, invoice.paid, etc.
  payload       String    // JSON payload
  
  // Status
  status        String    @default("pending") // pending, success, failed
  responseCode  Int?
  responseBody  String?
  
  // Retry
  attempts      Int       @default(0)
  nextRetryAt   DateTime?
  
  // Relations
  webhookId     String
  webhook       WebhookEndpoint @relation(fields: [webhookId], references: [id], onDelete: Cascade)
  
  deliveredAt   DateTime?
  createdAt     DateTime  @default(now())
  
  @@index([webhookId])
  @@index([status])
  @@index([createdAt])
}

model Backup {
  id            String    @id @default(uuid())
  type          String    // database, files, full
  status        String    @default("pending") // pending, in-progress, completed, failed
  
  // Storage
  fileUrl       String?
  fileSize      Int?      // in bytes
  
  // Metadata
  recordCount   Int?
  duration      Int?      // in seconds
  error         String?
  
  // Schedule info
  isScheduled   Boolean   @default(false)
  
  triggeredBy   String?   // Admin ID or "system"
  
  completedAt   DateTime?
  createdAt     DateTime  @default(now())
  
  @@index([type])
  @@index([status])
  @@index([createdAt])
}
