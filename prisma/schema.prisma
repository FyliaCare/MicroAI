generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
  binaryTargets   = ["native"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Client {
  id               String           @id @default(uuid())
  name             String
  email            String           @unique
  phone            String?
  company          String?
  website          String?
  address          String?
  notes            String?
  status           String           @default("active")
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  city             String?
  companySize      String?
  country          String?          @default("Ghana")
  customFields     String?
  industry         String?
  preferredContact String?
  referredBy       String?
  source           String?
  tags             String?
  taxId            String?
  timezone         String?          @default("Africa/Accra")
  hasPortalAccess  Boolean          @default(false)
  userId           String?          @unique
  user             User?            @relation(fields: [userId], references: [id])
  uploads          ClientUpload[]
  communications   Communication[]
  contracts        Contract[]
  documents        Document[]
  invoices         Invoice[]
  projects         Project[]
  projectRequests  ProjectRequest[]
  quotes           Quote[]

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([name])
  @@index([company])
  @@index([country])
  @@index([userId])
  @@index([hasPortalAccess])
}

model Project {
  id             String        @id @default(uuid())
  name           String
  description    String?
  type           String
  status         String        @default("planning")
  priority       String        @default("medium")
  budget         Float?
  actualCost     Float?
  revenue        Float?
  profitMargin   Float?
  startDate      DateTime?
  endDate        DateTime?
  deadline       DateTime?
  completedAt    DateTime?
  techStack      String?
  githubRepo     String?
  liveUrl        String?
  stagingUrl     String?
  progress       Int           @default(0)
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  clientId       String?
  actualHours    Float?
  attachments    String?
  currency       String        @default("GHS")
  customFields   String?
  demoUrl        String?
  domain         String?
  estimatedHours Float?
  health         String        @default("good")
  hosting        String?
  lastChecked    DateTime?
  requirements   String?
  sslCertificate Boolean       @default(false)
  tags           String?
  uptime         Float         @default(100)
  comments       Comment[]
  deployments    Deployment[]
  documents      Document[]
  expenses       Expense[]
  invoices       Invoice[]
  milestones     Milestone[]
  client         Client?       @relation(fields: [clientId], references: [id])
  teamMembers    ProjectTeam[]
  quote          Quote?
  tasks          Task[]
  timeEntries    TimeEntry[]

  @@index([clientId])
  @@index([status])
  @@index([type])
  @@index([priority])
  @@index([createdAt])
  @@index([deadline])
  @@index([name])
  @@index([health])
}

model Quote {
  id                    String    @id @default(uuid())
  quoteNumber           String    @unique
  title                 String
  description           String?
  clientId              String?
  projectId             String?   @unique
  subtotal              Float?
  tax                   Float?    @default(0)
  discount              Float?    @default(0)
  total                 Float?
  items                 String?
  status                String    @default("draft")
  validUntil            DateTime?
  issuedAt              DateTime?
  sentAt                DateTime?
  viewedAt              DateTime?
  respondedAt           DateTime?
  notes                 String?
  terms                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  deliverables          String?
  designCost            Float?    @default(0)
  developmentCost       Float?    @default(0)
  estimatedHours        Float?
  hostingBreakdown      String?
  milestones            String?
  monthlyHosting        Float?    @default(0)
  monthlyMaintenance    Float?    @default(0)
  monthlyRecurring      Float?    @default(0)
  projectType           String?
  setupFee              Float?    @default(0)
  techStack             String?
  timeline              String?
  yearlyRecurring       Float?    @default(0)
  assumptions           String?
  clientAddress         String?
  clientCompany         String?
  clientEmail           String?
  clientName            String?
  clientObligations     String?
  clientPhone           String?
  clientSignature       String?
  clientSignedAt        DateTime?
  clientSignedBy        String?
  companyAddress        String?
  companyEmail          String?
  companyLogo           String?
  companyName           String?
  companyPhone          String?
  companyWebsite        String?
  confidentialityClause String?
  contactPerson         String?
  currency              String?   @default("USD")
  depositAmount         Float?
  depositPercent        Float?
  discountType          String?
  exclusions            String?
  executiveSummary      String?
  freeSupportMonths     Int?      @default(1)
  includedRevisions     Int?      @default(2)
  internalNotes         String?
  ipRights              String?
  maintenanceTerms      String?
  paymentTerms          String?
  pricingItems          String?
  providerSignature     String?
  providerSignedAt      DateTime?
  providerSignedBy      String?
  revisionCost          Float?
  revisionsPolicy       String?
  scopeOfWork           String?
  taxRate               Float?    @default(0)
  validityDays          Int       @default(30)
  templateStyle         String    @default("professional-locked")
  client                Client?   @relation(fields: [clientId], references: [id])
  project               Project?  @relation(fields: [projectId], references: [id])

  @@index([clientId])
  @@index([projectId])
  @@index([status])
  @@index([quoteNumber])
  @@index([createdAt])
  @@index([validUntil])
}

model Invoice {
  id              String    @id @default(uuid())
  invoiceNumber   String    @unique
  title           String
  description     String?
  clientId        String?
  projectId       String?
  subtotal        Float
  tax             Float     @default(0)
  discount        Float     @default(0)
  total           Float
  paidAmount      Float     @default(0)
  items           String
  status          String    @default("draft")
  paymentMethod   String?
  paymentDate     DateTime?
  issuedAt        DateTime?
  dueDate         DateTime?
  sentAt          DateTime?
  notes           String?
  terms           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  currency        String    @default("GHS")
  discountType    String    @default("amount")
  isRecurring     Boolean   @default(false)
  lastReminderAt  DateTime?
  recurringPeriod String?
  remindersSent   Int       @default(0)
  taxRate         Float     @default(0)
  client          Client?   @relation(fields: [clientId], references: [id])
  project         Project?  @relation(fields: [projectId], references: [id])
  payments        Payment[]

  @@index([clientId])
  @@index([projectId])
  @@index([status])
  @@index([invoiceNumber])
  @@index([dueDate])
  @@index([issuedAt])
}

model Task {
  id             String      @id @default(uuid())
  title          String
  description    String?
  status         String      @default("todo")
  priority       String      @default("medium")
  estimatedHours Float?
  actualHours    Float?
  startDate      DateTime?
  dueDate        DateTime?
  completedAt    DateTime?
  assignedTo     String?
  projectId      String?
  tags           String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  attachments    String?
  checklist      String?
  comments       Comment[]
  project        Project?    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  timeEntries    TimeEntry[]

  @@index([projectId])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
}

model Milestone {
  id            String    @id @default(uuid())
  title         String
  description   String?
  status        String    @default("pending")
  deliverables  String?
  dueDate       DateTime?
  completedAt   DateTime?
  paymentAmount Float?
  isPaid        Boolean   @default(false)
  projectId     String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  project       Project?  @relation(fields: [projectId], references: [id])
}

model Admin {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String
  name        String
  role        String    @default("admin")
  isActive    Boolean   @default(true)
  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  accounts    Account[]
  sessions    Session[]
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              Admin   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         Admin    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Service {
  id           String   @id @default(uuid())
  name         String
  description  String?
  category     String
  priceType    String   @default("fixed")
  basePrice    Float?
  minPrice     Float?
  maxPrice     Float?
  hourlyRate   Float?
  features     String?
  deliverables String?
  duration     String?
  isActive     Boolean  @default(true)
  isPopular    Boolean  @default(false)
  icon         String?
  color        String?
  sortOrder    Int      @default(0)
  tags         String?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model ActivityLog {
  id          String   @id @default(uuid())
  action      String
  entity      String
  entityId    String
  description String?
  userId      String?
  metadata    String?
  createdAt   DateTime @default(now())
}

model Notification {
  id         String    @id @default(uuid())
  type       String
  title      String
  message    String
  link       String?
  isRead     Boolean   @default(false)
  priority   String    @default("normal")
  entityType String?
  entityId   String?
  createdAt  DateTime  @default(now())
  readAt     DateTime?

  @@index([isRead])
  @@index([type])
  @@index([createdAt])
  @@index([priority])
}

model QuoteTemplate {
  id                 String   @id @default(uuid())
  name               String
  category           String
  description        String?
  setupFee           Float
  developmentCost    Float
  designCost         Float    @default(0)
  monthlyHosting     Float
  monthlyMaintenance Float    @default(0)
  estimatedHours     Float
  timeline           String
  techStack          String
  features           String
  deliverables       String
  hostingBreakdown   String
  milestones         String?
  actualCosts        String?
  profitMargin       Float    @default(100)
  isActive           Boolean  @default(true)
  sortOrder          Int      @default(0)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model TeamMember {
  id                 String        @id @default(uuid())
  name               String
  email              String        @unique
  phone              String?
  role               String
  title              String?
  skills             String?
  hourlyRate         Float?
  availability       String        @default("available")
  password           String?
  isActive           Boolean       @default(true)
  avatar             String?
  bio                String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  comments           Comment[]
  projectAssignments ProjectTeam[]
  timeEntries        TimeEntry[]

  @@index([email])
  @@index([role])
  @@index([isActive])
}

model ProjectTeam {
  id         String     @id @default(uuid())
  role       String
  projectId  String
  memberId   String
  assignedAt DateTime   @default(now())
  member     TeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)
  project    Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, memberId])
  @@index([projectId])
  @@index([memberId])
}

model TimeEntry {
  id          String      @id @default(uuid())
  description String
  hours       Float
  date        DateTime    @default(now())
  billable    Boolean     @default(true)
  hourlyRate  Float?
  projectId   String?
  taskId      String?
  memberId    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  member      TeamMember? @relation(fields: [memberId], references: [id])
  project     Project?    @relation(fields: [projectId], references: [id])
  task        Task?       @relation(fields: [taskId], references: [id])

  @@index([projectId])
  @@index([taskId])
  @@index([memberId])
  @@index([date])
}

model Document {
  id          String   @id @default(uuid())
  name        String
  description String?
  type        String
  fileUrl     String
  fileSize    Int?
  mimeType    String?
  isPublic    Boolean  @default(false)
  clientId    String?
  projectId   String?
  uploadedBy  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  client      Client?  @relation(fields: [clientId], references: [id])
  project     Project? @relation(fields: [projectId], references: [id])

  @@index([clientId])
  @@index([projectId])
  @@index([type])
  @@index([createdAt])
}

model Comment {
  id         String      @id @default(uuid())
  content    String
  isInternal Boolean     @default(false)
  projectId  String?
  taskId     String?
  authorId   String?
  parentId   String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  author     TeamMember? @relation(fields: [authorId], references: [id])
  parent     Comment?    @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies    Comment[]   @relation("CommentReplies")
  project    Project?    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  task       Task?       @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([taskId])
  @@index([authorId])
  @@index([parentId])
  @@index([createdAt])
}

model Communication {
  id          String   @id @default(uuid())
  type        String
  subject     String?
  content     String
  direction   String
  clientId    String?
  from        String?
  to          String?
  cc          String?
  attachments String?
  sentBy      String?
  createdAt   DateTime @default(now())
  client      Client?  @relation(fields: [clientId], references: [id])

  @@index([clientId])
  @@index([type])
  @@index([createdAt])
}

model Contract {
  id                String    @id @default(uuid())
  title             String
  description       String?
  type              String
  status            String    @default("draft")
  content           String
  clientId          String?
  startDate         DateTime?
  endDate           DateTime?
  signedAt          DateTime?
  value             Float?
  currency          String    @default("GHS")
  documentUrl       String?
  signedDocumentUrl String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  client            Client?   @relation(fields: [clientId], references: [id])

  @@index([clientId])
  @@index([status])
  @@index([type])
  @@index([startDate])
}

model Deployment {
  id          String   @id @default(uuid())
  version     String
  environment String
  status      String
  commitHash  String?
  branch      String?
  deployedBy  String?
  url         String?
  notes       String?
  changelog   String?
  buildTime   Int?
  projectId   String
  deployedAt  DateTime @default(now())
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([environment])
  @@index([status])
  @@index([deployedAt])
}

model Expense {
  id            String    @id @default(uuid())
  description   String
  category      String
  amount        Float
  currency      String    @default("GHS")
  paymentMethod String?
  receipt       String?
  projectId     String?
  date          DateTime  @default(now())
  paidAt        DateTime?
  status        String    @default("pending")
  vendor        String?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  project       Project?  @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@index([category])
  @@index([date])
  @@index([status])
}

model Payment {
  id        String    @id @default(uuid())
  amount    Float
  currency  String    @default("GHS")
  method    String
  reference String?
  receipt   String?
  invoiceId String?
  status    String    @default("pending")
  paidAt    DateTime?
  notes     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  invoice   Invoice?  @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId])
  @@index([status])
  @@index([paidAt])
  @@index([reference])
}

model Setting {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String
  type        String
  category    String
  description String?
  updatedAt   DateTime @updatedAt

  @@index([category])
}

model AuditLog {
  id          String   @id @default(uuid())
  action      String
  entity      String
  entityId    String?
  oldValue    String?
  newValue    String?
  userId      String?
  userEmail   String?
  userIp      String?
  userAgent   String?
  description String?
  metadata    String?
  createdAt   DateTime @default(now())

  @@index([entity])
  @@index([entityId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

model EmailTemplate {
  id        String   @id @default(uuid())
  name      String
  subject   String
  content   String
  type      String
  variables String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([isActive])
}

model EmailLog {
  id         String    @id @default(uuid())
  to         String
  from       String
  subject    String
  content    String?
  status     String    @default("pending")
  provider   String?
  providerId String?
  error      String?
  retryCount Int       @default(0)
  templateId String?
  clientId   String?
  sentAt     DateTime?
  createdAt  DateTime  @default(now())

  @@index([to])
  @@index([status])
  @@index([createdAt])
  @@index([templateId])
}

model ApiKey {
  id          String    @id @default(uuid())
  name        String
  key         String    @unique
  description String?
  permissions String
  rateLimit   Int       @default(1000)
  isActive    Boolean   @default(true)
  expiresAt   DateTime?
  lastUsedAt  DateTime?
  usageCount  Int       @default(0)
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([key])
  @@index([isActive])
}

model WebhookEndpoint {
  id         String            @id @default(uuid())
  url        String
  events     String
  secret     String?
  isActive   Boolean           @default(true)
  maxRetries Int               @default(3)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  deliveries WebhookDelivery[]

  @@index([isActive])
}

model WebhookDelivery {
  id           String          @id @default(uuid())
  event        String
  payload      String
  status       String          @default("pending")
  responseCode Int?
  responseBody String?
  attempts     Int             @default(0)
  nextRetryAt  DateTime?
  webhookId    String
  deliveredAt  DateTime?
  createdAt    DateTime        @default(now())
  webhook      WebhookEndpoint @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([status])
  @@index([createdAt])
}

model Backup {
  id          String    @id @default(uuid())
  type        String
  status      String    @default("pending")
  fileUrl     String?
  fileSize    Int?
  recordCount Int?
  duration    Int?
  error       String?
  isScheduled Boolean   @default(false)
  triggeredBy String?
  completedAt DateTime?
  createdAt   DateTime  @default(now())

  @@index([type])
  @@index([status])
  @@index([createdAt])
}

model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  password           String
  name               String
  role               String              @default("client")
  isActive           Boolean             @default(true)
  isVerified         Boolean             @default(false)
  mustChangePassword Boolean             @default(true)
  lastLoginAt        DateTime?
  loginAttempts      Int                 @default(0)
  lockedUntil        DateTime?
  passwordChangedAt  DateTime?
  accessExpiresAt    DateTime?
  verificationToken  String?             @unique
  verificationExpiry DateTime?
  resetToken         String?             @unique
  resetTokenExpiry   DateTime?
  avatar             String?
  phone              String?
  timezone           String?             @default("Africa/Accra")
  emailNotifications Boolean             @default(true)
  smsNotifications   Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  address            String?
  bio                String?
  city               String?
  company            String?
  country            String?             @default("Ghana")
  jobTitle           String?
  state              String?
  website            String?
  zipCode            String?
  client             Client?
  sessions           ClientSession[]
  codeAccessRequests CodeAccessRequest[]
  emailQueue         EmailQueue[]
  projectUpdatesRead ProjectUpdateRead[]
  assignedChats      ChatSession[]

  @@index([email])
  @@index([role])
  @@index([isActive])
  @@index([isVerified])
  @@index([accessExpiresAt])
}

model ProjectRequest {
  id                 String    @id @default(uuid())
  requestNumber      String    @unique
  clientName         String
  clientEmail        String
  clientPhone        String?
  clientCompany      String?
  clientWebsite      String?
  projectName        String
  projectType        String
  description        String
  industry           String?
  requirements       String
  features           String?
  techPreferences    String?
  budget             Float?
  budgetRange        String?
  timeline           String?
  startDate          DateTime?
  deadline           DateTime?
  priority           String    @default("normal")
  status             String    @default("pending")
  reviewedBy         String?
  reviewedAt         DateTime?
  reviewNotes        String?
  rejectionReason    String?
  convertedToProject Boolean   @default(false)
  projectId          String?
  clientId           String?
  chatTranscript     String?
  attachments        String?
  source             String    @default("website")
  referrer           String?
  utmSource          String?
  utmMedium          String?
  utmCampaign        String?
  ipAddress          String?
  country            String?
  city               String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  client             Client?   @relation(fields: [clientId], references: [id])

  @@index([status])
  @@index([clientEmail])
  @@index([projectType])
  @@index([createdAt])
  @@index([requestNumber])
  @@index([convertedToProject])
}

model ClientUpload {
  id                String    @id @default(uuid())
  name              String
  originalName      String
  description       String?
  category          String
  fileUrl           String
  fileSize          Int
  mimeType          String
  format            String?
  width             Int?
  height            Int?
  colorPalette      String?
  version           Int       @default(1)
  previousVersionId String?
  isLatest          Boolean   @default(true)
  status            String    @default("active")
  isApproved        Boolean   @default(false)
  approvedBy        String?
  approvedAt        DateTime?
  projectId         String?
  clientId          String?
  uploadedBy        String?
  uploadedByRole    String?
  tags              String?
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  client            Client?   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([clientId])
  @@index([category])
  @@index([status])
  @@index([isLatest])
  @@index([createdAt])
}

model ProjectUpdate {
  id              String              @id @default(uuid())
  title           String
  content         String
  type            String              @default("progress")
  isPublic        Boolean             @default(true)
  isImportant     Boolean             @default(false)
  summary         String?
  attachments     String?
  progressBefore  Int?
  progressAfter   Int?
  projectId       String
  postedBy        String?
  postedByName    String?
  emailSent       Boolean             @default(false)
  emailSentAt     DateTime?
  emailRecipients String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  readBy          ProjectUpdateRead[]

  @@index([projectId])
  @@index([type])
  @@index([isPublic])
  @@index([createdAt])
  @@index([emailSent])
}

model ProjectUpdateRead {
  id       String        @id @default(uuid())
  updateId String
  userId   String
  readAt   DateTime      @default(now())
  update   ProjectUpdate @relation(fields: [updateId], references: [id], onDelete: Cascade)
  user     User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([updateId, userId])
  @@index([updateId])
  @@index([userId])
  @@index([readAt])
}

model CodeAccessRequest {
  id                String    @id @default(uuid())
  requestNumber     String    @unique
  projectId         String
  userId            String
  clientName        String
  clientEmail       String
  reason            String?
  githubUsername    String?
  status            String    @default("pending")
  requestedAt       DateTime  @default(now())
  reviewedAt        DateTime?
  reviewedBy        String?
  reviewNotes       String?
  rejectionReason   String?
  autoApprovedAt    DateTime?
  repoUrl           String?
  accessGranted     Boolean   @default(false)
  accessGrantedAt   DateTime?
  inviteSent        Boolean   @default(false)
  inviteAccepted    Boolean   @default(false)
  accessMethod      String?
  accessCredentials String?
  downloadUrl       String?
  downloadExpiry    DateTime?
  emailSent         Boolean   @default(false)
  emailSentAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId])
  @@index([status])
  @@index([requestedAt])
  @@index([autoApprovedAt])
  @@index([requestNumber])
}

model EmailQueue {
  id            String    @id @default(uuid())
  to            String
  cc            String?
  bcc           String?
  subject       String
  htmlContent   String
  textContent   String?
  templateType  String?
  templateVars  String?
  status        String    @default("pending")
  priority      String    @default("normal")
  attempts      Int       @default(0)
  maxAttempts   Int       @default(3)
  lastAttemptAt DateTime?
  nextRetryAt   DateTime?
  error         String?
  errorDetails  String?
  provider      String?
  providerId    String?
  metadata      String?
  userId        String?
  clientId      String?
  projectId     String?
  sentAt        DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  user          User?     @relation(fields: [userId], references: [id])

  @@index([status])
  @@index([priority])
  @@index([createdAt])
  @@index([nextRetryAt])
  @@index([to])
}

model ScheduledTask {
  id              String    @id @default(uuid())
  taskName        String    @unique
  taskType        String
  cronExpression  String
  isActive        Boolean   @default(true)
  lastRunAt       DateTime?
  lastStatus      String?
  lastRunDuration Int?
  lastError       String?
  nextRunAt       DateTime?
  executionCount  Int       @default(0)
  config          String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([taskName])
  @@index([taskType])
  @@index([isActive])
  @@index([nextRunAt])
  @@index([lastRunAt])
}

model GitHubIntegration {
  id            String    @id @default(uuid())
  projectId     String    @unique
  repoName      String
  repoOwner     String
  repoFullName  String
  repoUrl       String
  repoId        Int?
  isPrivate     Boolean   @default(true)
  defaultBranch String    @default("main")
  webhookId     Int?
  webhookSecret String?
  webhookActive Boolean   @default(false)
  cloneUrl      String?
  sshUrl        String?
  isActive      Boolean   @default(true)
  lastSync      DateTime?
  syncStatus    String?
  syncError     String?
  language      String?
  description   String?
  topics        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([projectId])
  @@index([repoFullName])
  @@index([isActive])
}

model ClientSession {
  id             String   @id @default(uuid())
  userId         String
  sessionToken   String   @unique
  ipAddress      String?
  userAgent      String?
  deviceType     String?
  browser        String?
  os             String?
  country        String?
  city           String?
  isActive       Boolean  @default(true)
  expiresAt      DateTime
  lastActivityAt DateTime @default(now())
  createdAt      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionToken])
  @@index([isActive])
  @@index([expiresAt])
}

model ActivityFeed {
  id               String   @id @default(uuid())
  type             String
  title            String
  description      String?
  actorType        String
  actorId          String?
  actorName        String?
  targetType       String?
  targetId         String?
  targetName       String?
  isPublic         Boolean  @default(true)
  visibleToClients String?
  projectId        String?
  clientId         String?
  metadata         String?
  icon             String?
  color            String?
  createdAt        DateTime @default(now())

  @@index([type])
  @@index([projectId])
  @@index([clientId])
  @@index([isPublic])
  @@index([createdAt])
  @@index([actorType])
}

model PushSubscription {
  id        String   @id
  endpoint  String   @unique
  p256dh    String
  auth      String
  userId    String?
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([endpoint])
  @@index([userId])
}

model VisitorMessage {
  id              String          @id
  sessionId       String
  content         String
  sender          String          @default("visitor")
  senderName      String?
  isRead          Boolean         @default(false)
  readAt          DateTime?
  attachments     String?
  metadata        String?
  createdAt       DateTime        @default(now())
  VisitorTracking VisitorTracking @relation(fields: [sessionId], references: [sessionId], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([sender])
  @@index([sessionId])
}

model VisitorTracking {
  id              String           @id
  sessionId       String           @unique
  ipAddress       String?
  location        String?
  country         String?
  city            String?
  region          String?
  device          String?
  browser         String?
  os              String?
  currentPage     String?
  entryPage       String?
  referrer        String?
  utmSource       String?
  utmMedium       String?
  utmCampaign     String?
  pageViews       Int              @default(1)
  duration        Int              @default(0)
  isActive        Boolean          @default(true)
  lastActivity    DateTime         @default(now())
  hasInteracted   Boolean          @default(false)
  interactionType String?
  metadata        String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  VisitorMessage  VisitorMessage[]

  @@index([createdAt])
  @@index([ipAddress])
  @@index([isActive])
  @@index([lastActivity])
  @@index([sessionId])
}

model ChatSession {
  id              String          @id @default(uuid())
  visitorId       String?
  visitorName     String?
  visitorEmail    String?
  visitorPhone    String?
  visitorIp       String?
  visitorDevice   String?
  visitorBrowser  String?
  visitorLocation String?
  currentPage     String?
  referrer        String?
  status          String          @default("active") // active, closed, archived
  assignedToId    String?
  assignedTo      User?           @relation(fields: [assignedToId], references: [id])
  rating          Int?
  feedback        String?
  tags            String?
  metadata        String?
  startedAt       DateTime        @default(now())
  closedAt        DateTime?
  lastMessageAt   DateTime        @default(now())
  messages        ChatMessage[]
  
  @@index([visitorId])
  @@index([visitorEmail])
  @@index([status])
  @@index([assignedToId])
  @@index([startedAt])
  @@index([lastMessageAt])
}

model ChatMessage {
  id              String      @id @default(uuid())
  sessionId       String
  session         ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  senderId        String?
  senderType      String      // visitor, admin
  senderName      String?
  message         String
  messageType     String      @default("text") // text, file, image, system
  fileUrl         String?
  fileName        String?
  fileSize        Int?
  fileType        String?
  isRead          Boolean     @default(false)
  readAt          DateTime?
  metadata        String?
  createdAt       DateTime    @default(now())
  
  @@index([sessionId])
  @@index([senderId])
  @@index([senderType])
  @@index([isRead])
  @@index([createdAt])
}

model ChatTypingIndicator {
  id        String   @id @default(uuid())
  sessionId String
  userId    String?
  userType  String   // visitor, admin
  userName  String?
  isTyping  Boolean  @default(true)
  updatedAt DateTime @updatedAt
  
  @@unique([sessionId, userType])
  @@index([sessionId])
  @@index([isTyping])
}

model VisitorAnalytics {
  id            String   @id @default(uuid())
  visitorId     String?
  sessionId     String?
  ipAddress     String?
  country       String?
  city          String?
  region        String?
  latitude      Float?
  longitude     Float?
  device        String?
  browser       String?
  os            String?
  referrer      String?
  landingPage   String?
  pagesVisited  String?  // JSON array of pages
  sessionStart  DateTime @default(now())
  sessionEnd    DateTime?
  duration      Int?     // in seconds
  interactions  Int      @default(0)
  converted     Boolean  @default(false)
  createdAt     DateTime @default(now())
  
  @@index([ipAddress])
  @@index([country])
  @@index([sessionStart])
  @@index([converted])
}
